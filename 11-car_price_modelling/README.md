
# Прогнозирование цены автомобиля

## Описание проекта
Сервис по продаже автомобилей с пробегом «Не бит, не крашен» разрабатывает приложение для привлечения новых клиентов. В нём можно быстро узнать рыночную стоимость своего автомобиля. В вашем распоряжении исторические данные: технические характеристики, комплектации и цены автомобилей. Вам нужно построить модель для определения стоимости. 

Заказчику важны:
  - качество предсказания;
  - скорость предсказания;
  - время обучения.

## Этапы проекта
1. Загрузим и проведем предобработку данных: исправим типы данных, проанализируем пропуски и дубликаты, создадим новые столбцы.
2. Проведем исследовательский анализ: изучим парные корреляции признаков и постмотрим на распределения признаков.
3. Обучим модели:
  - модель дерева с поиском параметров в цикле,
  - модель дерева с поиском параметров через GridsearchCV
  - простая линейная регрессия
  - линейная регрессия с кроссвалидацией
  - регрессия LightGBD
4. Оценим результаты, протестируем лучшую модель и проверим ее на адекватность.
5. Сформулируем общие выводы.
   
## Результат
<br>**В ходе подготовки данных сделали следующее:**
- загрузили исходные данные и проведен первичный анализ
- наименования столбцов привели к  классическому виду (змеиный регистр)
- типы данных привели к соответствующим им данным:
    - 'date_crawled', 'date_created', 'last_seen' - к типу datetime
    - 'postal_code' - к строке
- Заполнили пропуски в данных:
    - в поле 'model' -   значением 'unknown'
    - в поле 'vehicle_type' - модой в разрезе бренда и модели
    - в поле 'repaired' -  значением 'no'
    - в поле 'gearbox' -  модой в разрезе бренда и модели
    - в поле 'fuel_type' - модой в разрезе бренда и модели
- Изучили и исправили аномалии в данных:
    - в поле 'registration_year' аномалии скорректирваны в зависимости от пробега автомобиля
    - в поле 'registration_month' аномалии (нулевой месяц) заполнены серединой года, т.е. 6м месяцем.
    - в поле 'power' аномальные значения мощности заполнены медианой в разрезе бренда и модели
    - объявления с отсутствующими значениями в поле 'price' удалены, т.к. поле является целевым признаком
- Удалили следующие столбцы:
    - столбец 'number_of_pictures', так как поле не содержит иных значений, кроме 0.
    - столбцы 'date_crawled', 'date_created', 'last_seen' также удалены, так они не характеризуют продаваемый автомобиль, а относятся к дате публикации объявления и активности пользователя на сайте.

<br>**В ходе исследовательского анализа данных выяснили, что:**
- наблюдается рост мощности мощности машин с течение времени (чем ближе registration_year к текущему году, тем больше машин с высокой мощностью)
- между мощностью и ценой наблюдается как-будто обратная зависимость, однако это скорее особенность аномальных данных, котоыре мы не затронули. Чаще всего мощность машин все-таки не превышает 500л.с., мы же брали в качестве ограничения максимальную мощность в 4000л.с. поэтому если посмотреть в нижнюю часть графика, где скорее всего расположеныы наиболее реальные данные, то можно увидеть небольшое увеличение плоности графика и положительную корреляцию.
- основная доля объявлений - по машинам от 1950 года регистрации и позже.
- Наибольшая корреляция наблюдается между признаками:
    - registration_year & price (0,42)
    - power & price (0,4)
<br>Это средний уровень корреляции. Можно в целом сделать вывод, что цена в наибольшей степени зависит от этих двух признаков, однако каждый из них по отдельности не может служить достаточным для прогнозирования цены - она зависит от совокупности нескольких признаков.
- Наблюдается отрицательная корреляция между признаками:
    - ценой и пробегом авто (что логично)
    - годом регистрации авто и пробегом (что тоже логично - чем моложе авто, тем меньше пробег)
- Корреляция между остальными признаками (и к цене в том числе) не превышает 0,01, что говорит о полном отсутствием какой-либо зависимости.
- Мультиколлинеарности между признаками не наблюдается.

<br>**В ходе поиска модели с наилучшими показателями сделали следующее:**
- рассмотрели следующие виды моделей:
    - дерево решений (с глубиной от 2 до 100) с поиском в цикле
    - дерево решений (с глубиной от 2 до 100) с поиском через GridSearch
    - линейная регрессия без кроссвалидации
    - линейная регрессия с кроссвалидацией
    - модель регрессии LightGBM
- в качестве метрики качества выбрали функцию RMSE
<br>Для каждой из моделей также замерили время обучения и предсказания модели
<br>Получили следующие результаты:
- Модель поиска дерева решений в цикле:
    - время выполнения =  82.88305640220642
    - RMSE= 2037.9662482111983
- Модель поиска дерева решений через GridSearchCV:
    - время выполнения=  1141.9148917198181
    - RMSE= 2054.7212376879606
- Модель простой линейной регрессии (get_dummies):
    - время выполнения=  20.409640789031982
    - RMSE= 2926.6544079492505
- Модель простой линейной регрессии (ohe):
    - время выполнения=  22.002384901046753
    - RMSE= 3614.8411474509016
- Модель линейной регрессии с кроссвалидацией (ohe_cv):
    - время выполнения=  134.4584105014801
    - RMSE= 2941.0234617452957
- Модель LightGBM:
    - время выполнения=  877.5172863006592
    - RMSE= 1797.4987067807833
    
<br>Наилучшая из найденных моделей - модель LightGBM.
<br>Минимальное значение RMSE на валидационной выборке - 1797.

<br>**Тестирование модели:**
- на этапе тестирования получили следующие результаты: RMSE = 1784
- также проверили модель против случайной модели. Показатель RMSE случайной модели - 4517, что гораздо выше модели LightGBM, значит, обученная модель LightGBM работает лучше.

<br>**Оценка важности признаков:**
<br>Оценка важности признаков показала, что сильнее всего влияют год регистрации, мощность и пробег авто:
- registration_year     0.529297
- power                 0.276632
- kilometer             0.083210
- brand                 0.031690
- vehicle_type          0.031307
- model                 0.020778
- repaired              0.017140
- registration_month    0.007399
- gearbox               0.002012
- fuel_type             0.000535

## Технические параметры среды
Библиотеки: pandas, numpy, sklearn, lightgbm, matplotlib, seaborn
<br>Версия Python: 3.9.5
